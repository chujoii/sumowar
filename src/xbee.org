* connection to computer (FT232RL)

| ftdi | lilypad - zigbee |
|------+------------------|
| gnd  | gnd              |
| rx   | rx (not crossed) |
| tx   | tx (not crossed) |
| -    | 3.3 (external)   |


Air, Earth - Xbee Series 2





* AT-command

+++ 


** example 
   ATDT 1F<CR>
   | AT prefix | ASCII command | Space (optional) | Parameter (optional, HEX) | Carriage Return ('\r', 0x0D) |
   |-----------+---------------+------------------+---------------------------+------------------------------|
   | AT        | DT            |                  | 1F                        | <CR>                         |



| command | parameter | description                                                                               |
|---------+-----------+-------------------------------------------------------------------------------------------|
| ATBD    |         3 | read/write serial port speed 0:1200 1:2400 2:4800 3:9600 4:19200 5:38400 6:57600 7:115200 |
| ATID    |           | network identifier                                                                        |
| ---ATMY |           | node identifier MY sets the 16bit address                                                 |
| ATDH    |           | destination node identifier 64bit address                                                 |
| ATDL    |           | destination node identifier 64bit address                                                 |
|         |           |                                                                                           |
| ATND    |           | обнаружить все узлы сети                                                                  |
|         |           |                                                                                           |
| ATCN    |           | leave command mode                                                                        |
| ATWR    |           | write settings to firmware                                                                |


* string format
  Unix format Line feed LF ('\n', 0x0A)
  DOS format carriage_return + Line_feed CR+LF ('\r\n', 0x0D 0x0A)
  
  picocom --omap lfcr,delbs --imap crcrlf,bsdel --echo --baud 9600 /dev/ttyUSB0
  exit: C-a C-x 


* simple echo AT-mode
** earth configure
   "Coordinator AT"
   +++
   
   ATSH
   >>>> 123456
   
   ATSL
   >>>> ABCDEF12
   
   ATID 3
   ATDH 0
   ATDL 7
   ATWR
   ATCN
   
** air configure
   "Router/end device AT"
   +++
   
   ATSH
   >>>> 123456
   
   ATSL
   >>>> ABCDEF01
   
   ATID 7
   ATDH 0
   ATDL 3
   ATWR
   ATCN
   
   
   At air need connect "rx" and "tx"
   
   
   
** earth test work
   print "test" (without +++)




* adc API-mode

** earth configure
   "Coordinator API"

** air configure
   "Router/end device AT"
   
   +++
   ATD0 2 ;; enable ADC in pin D0
   ;; ATIR 0 ;; not need
   


   
   
   
** air testing from PC
   +++
   ATD4 4        ;; off LED
   ATAC          ;; or ATCN apply port state

   ATIS          ;; read from photodiode dark current
   >>>> 01       ;; 1 byte ;; number of samples (in packet)
   >>>> 0000     ;; 2 byte ;; (Digital channel mask of) all digital pins reported on as list
   >>>> 01       ;; 1 byte ;; ADC D0 (analog channel mask of) all analog pins reported on as list 
   >>>> 0312     ;; 2 byte ;; (/ (* #x0312 1.2) #x3FF)    ;; #x3FF ==1.2V    #x0312 readed

   ATD4 5        ;; on LED
   ATAC          ;; or ATCN apply port state
   
   ATIS          ;; read from photodiode dark current
   >>>> 01       ;; 1 byte ;; number of samples (in packet)
   >>>> 0000     ;; 2 byte ;; (Digital channel mask of) all digital pins reported on as list
   >>>> 01       ;; 1 byte ;; ADC D0 (analog channel mask of) all analog pins reported on as list 
   >>>> 0312     ;; 2 byte ;; (/ (* #x0312 1.2) #x3FF)    ;; #x3FF ==1.2V    #x0312 readed
   
   ATD4 4        ;; off LED
   ATAC          ;; or ATCN apply port state



   | command | description                                                                   |
   |---------+-------------------------------------------------------------------------------|
   | +++     | start                                                                         |
   |         |                                                                               |
   | ATD4 4  | LED "off"                                                                     |
   |         |                                                                               |
   | ATAC    | apply port state                                                              |
   |         |                                                                               |
   | ATIS    | read from photodiode dark current from ADC                                    |
   | > 01    | 1 byte ;; number of samples (in packet)                                       |
   | > 0010  | 2 byte ;; (Digital channel mask of) all digital pins reported on as list      |
   | > 01    | 1 byte ;; ADC D0 (analog channel mask of) all analog pins reported on as list |
   | > 0000  | 2 byte ;; DO pin is off                                                       |
   | > 00CC  | 2 byte ;; #x3FF == 1.2V   #x00CC readed => (/ (* #x00CC 1.2) #x3FF) = 0.24 V  |
   |         |                                                                               |
   | ATD4 5  | LED "on"                                                                      |
   |         |                                                                               |
   | ATAC    | apply port state                                                              |
   |         |                                                                               |
   | ATIS    | read from photodiode dark current from ADC                                    |
   | > 01    | 1 byte ;; number of samples (in packet)                                       |
   | > 0010  | 2 byte ;; (Digital channel mask of) all digital pins reported on as list      |
   | > 01    | 1 byte ;; ADC D0 (analog channel mask of) all analog pins reported on as list |
   | > 0010  | 2 byte ;; D4 pin is on                                                        |
   | > 022D  | 2 byte ;; #x3FF == 1.2V   #x022D readed => (/ (* #x022D 1.2) #x3FF) = 0.65 V  |
   |         |                                                                               |
   | ATD4 4  | LED "off"                                                                     |
   |         |                                                                               |
   | ATAC    | apply port state                                                              |


